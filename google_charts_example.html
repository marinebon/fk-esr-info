<html>
<head>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', {packages: ['corechart']});

    var Google_Spreadsheet_Link = 
        'https://docs.google.com/spreadsheets/d/1K05MhN9jdfIU8k4URGVnR3np3BZF1BmYGtvILsL_qPU/edit#gid=949872079';

//    var Google_Spreadsheet_Link = 
//        'https://docs.google.com/spreadsheets/d/1pouebRKHGKyUFdmtw8QKexY7JceJOyVoETKRbE4q2h8/edit#gid=376679084';

    var YAxisTitle = "Red Grouper Abundance";

    google.charts.setOnLoadCallback(drawGID);

    function drawGID() {
      var query = new google.visualization.Query(Google_Spreadsheet_Link);
      query.send(handleQueryResponse);
    }

    function handleQueryResponse(response) {

      var GoogleData = response.getDataTable();
      var areaStyle = 'stroke-width: 0;';
      var maxValue = GoogleData.getColumnRange(1).max*1.1 ;

      GoogleData.addColumn('number','Background');
      GoogleData.addColumn( {role: 'style', type: 'string'});
      GoogleData.addColumn( {role: 'annotation', type: 'string'});

      var beginning_row = 0;
      var threshold_year = 2011;
      var annotation_text = "Trends since " + threshold_year;

      var beginning_year = GoogleData.getColumnRange(0).min; 
      if (beginning_year <= threshold_year) {
          beginning_row = GoogleData.getFilteredRows([{column: 0, minValue: threshold_year}])[0];
      }
      else {
        annotation_text = "Trends since " + beginning_year;
      }

      var ending_row = GoogleData.getNumberOfRows();
      console.log  (GoogleData.getNumberOfColumns());

      var columnNumber = GoogleData.getNumberOfColumns() - 1;

      for (let i = beginning_row; i < ending_row; i++) {
        GoogleData.setCell(i, columnNumber - 2, maxValue);  
        GoogleData.setCell(i, columnNumber - 1, areaStyle);
      }

      var annotation_row = Math.round((ending_row - beginning_row)/2) + beginning_row ;

      GoogleData.setCell(annotation_row, 4, annotation_text);

      var areaColumn = 1;  //columnNumber - 3;


      var tempo = new Array(2, [2,8], 8);
      console.log(tempo);

      var options = {
        annotations: {stem: {length: 0}, 
          textStyle: {
            bold: false,
            italic: false,
            color: 'black',
            opacity: 1.0
          }
        },
        legend: 'bottom', 
        animation: {startup: true, duration:500}, // animate the graph
        height: 400, // make the graph 400 pixels high
        seriesType: 'line',
       series: { 1: {type: "area", color: 'CornflowerBlue', visibleInLegend: false}},
    //    series: array(1 ),

        hAxis: { // options for the X Axis
            title: "Year", // Set the X Axis title
            gridlines: {color: 'transparent'}, // no X Axis gridlines
            format: '####', // No commas in the X Axis labels
            titleTextStyle: {bold: false, italic: false }}, // Set how the X Axis title looks
        vAxis: {  // options for the Y Axis
                        viewWindow: {max: maxValue}, 
            title: YAxisTitle,  // Set the Y Axis title
            titleTextStyle: {bold: false, italic: false }, // Set how the Y Axis title looks
            minorGridlines: {color: 'transparent'}} // No minor Y Axis gridlines
        };

      // Create a line chart (note the use of LineChart in the command) and put that in the div element 'chart_div'
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

      // Create the graph using the options that we set above
      chart.draw(GoogleData, options);
    }

  </script>
</head>
<body>
  <!-- Identify where the chart should be drawn. -->
  <div id="chart_div"/>
</body>

</html>
